<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.review">
  <resultMap type="Review_article_dto" id="reviewResult">
    <result property="review_no" column="review_no"/>
    <result property="review_level" column="REVIEW_LEVEL"/>
    <result property="review_title" column="REVIEW_TITLE"/>
    <result property="review_content" column="REVIEW_CONTENT"/>
    <result property="id" column="ID"/>
    <result property="writeDate" column="WRITE_DATE"/>
    <result property="reviewParent_no" column="reviewParent_no"/>
  </resultMap>

  <resultMap type="Review_image_dto" id="review_imageResult">
            <result property="imageFileNo" column="imageFileNo"/>
			<result property="imageFileName" column="imageFileName"/>
			<result property="review_no" column="review_no"/>
  </resultMap>

 <insert id="insertArticle" parameterType="Review_article_dto" >
 <![CDATA[
    INSERT INTO REVIEW_BOARD (review_level, review_title, review_content, ID, WRITE_DATE)
    VALUES (#{review_level}, #{review_title}, #{review_content}, #{id}, #{writeDate}, null)
    ]]>
  </insert>
  
<select id="selectAllReviewList" resultMap="reviewResult">
			<![CDATA[
				select review_no, id, review_level, review_title, writeDate, review_content,reviewParent_no from REVIEW_BOARD
				start with reviewParent_no=0
				connect by prior review_no = reviewParent_no
				order siblings by review_no desc
			]]>
		</select> 
		
		<select id="selectNewReviewNo" resultType="int">
			<![CDATA[
				select max(review_no)+1 from REVIEW_BOARD
			]]>
		</select>
		
		<select id="selectReview" resultType="Review_article_dto" parameterType="int">
			<![CDATA[
				select * from REVIEW_BOARD where review_no=#{review_no}
			]]>
		</select>
		
		<update id="updateReview">
			<![CDATA[
				update REVIEW_BOARD 
				set review_title=#{review_title}, review_content=#{review_content}
				<if test="imageFileName != '' and imageFileName != null">
					, imageFileName=#{imageFileName}
				</if>
			]]>
			where review_no=#{review_no}
		</update>
		
		<delete id="deleteReview" parameterType="int">
			<![CDATA[
				delete from REVIEW_BOARD where reviewNo in (
				select 
			]]>
			
		</delete>

</mapper>
